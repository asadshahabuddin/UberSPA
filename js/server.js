/*
    Author: Asad Shahabuddin
    File: server.js
    Details: Configuration script for uberspa-farpoint.
    Email ID: shahabuddin.a@husky.neu.edu
*/

var express    = require("express");
var bodyParser = require("body-parser");
var multer     = require("multer");
var mongoose   = require("mongoose");
var app        = express();

app.use(express.static(__dirname + "/public"));
app.use(bodyParser.json());
app.use(bodyParser.urlencoded({extended: true}));
app.use(multer());

/* Set the environment variables we need */
var ip      = process.env.OPENSHIFT_NODEJS_IP      || '127.0.0.1';
var port    = process.env.OPENSHIFT_NODEJS_PORT    || 3000;
var connStr = process.env.OPENSHIFT_MONGODB_DB_URL || 'mongodb://localhost/cs8674';

/* Connect to MongoDB instance */
var db = mongoose.connect(connStr);

/* ======================== */
/* CITY COLLECTIONS : BEGIN */
/* ======================== */

/* Enforce schema */
var CitySchema = new mongoose.Schema({
    gid   : String,
    coords: []
}, {collection: "newyorkcity"});

/* Model */
var NYCModel = mongoose.model("NYCModel", CitySchema);

/* ====================== */
/* CITY COLLECTIONS : END */
/* ====================== */

/* ============ */
/* DATA : BEGIN */
/* ============ */

/* Author information */
var author = {
    fnm  : "Asad",
    lnm  : "Shahabuddin",
    alias: "Leo",
    email1: "asad808@ccs.neu.edu",
    email2: "shahabuddin.a@husky.neu.edu",
    url   : "http://net4.ccs.neu.edu/home/asad808/",
    city  : "Boston",
    state : "MA"
};

/*
// Group 0
var grp0Coords = [
    [40.785999, -73.943315], [40.790099, -73.943315], [40.794199, -73.943315], [40.785999, -73.947415],
    [40.798299, -73.943315], [40.790099, -73.947415], [40.794199, -73.947415], [40.790099, -73.951515],
    [40.790099, -73.955615], [40.794199, -73.951515], [40.794199, -73.955615], [40.798299, -73.947415],
    [40.798299, -73.951515], [40.798299, -73.955615], [40.802399, -73.951515], [40.802399, -73.947415],
    [40.806499, -73.947415], [40.802399, -73.943315], [40.806499, -73.943315], [40.810599, -73.943315],
    [40.814699, -73.943315], [40.818799, -73.939215], [40.814699, -73.939215], [40.810599, -73.939215],
    [40.822899, -73.935115], [40.818799, -73.935115], [40.814699, -73.935115], [40.806499, -73.939215],
    [40.810599, -73.935115], [40.806499, -73.935115], [40.802399, -73.939215], [40.802399, -73.935115],
    [40.798299, -73.931015], [40.798299, -73.935115], [40.794199, -73.931015], [40.798299, -73.939215],
    [40.794199, -73.935115], [40.794199, -73.939215], [40.790099, -73.939215], [40.785999, -73.939215],
    [40.785999, -73.943315]
];

// Group 1
var grp1Coords = [
    [40.765499, -73.959715], [40.769599, -73.959715], [40.765499, -73.963815], [40.773699, -73.959715],
    [40.769599, -73.963815], [40.769599, -73.967915], [40.769599, -73.972015], [40.773699, -73.963815],
    [40.773699, -73.967915], [40.773699, -73.972015], [40.777799, -73.967915], [40.777799, -73.963815],
    [40.781899, -73.963815], [40.777799, -73.959715], [40.785999, -73.963815], [40.781899, -73.959715],
    [40.785999, -73.959715], [40.790099, -73.959715], [40.785999, -73.955615], [40.781899, -73.955615],
    [40.785999, -73.951515], [40.781899, -73.951515], [40.777799, -73.955615], [40.781899, -73.947415],
    [40.777799, -73.951515], [40.777799, -73.947415], [40.773699, -73.943315], [40.773699, -73.947415],
    [40.773699, -73.951515], [40.769599, -73.947415], [40.773699, -73.955615], [40.769599, -73.951515],
    [40.765499, -73.951515], [40.769599, -73.955615], [40.765499, -73.955615]
];

// Group 2
var grp2Coords = [
    [40.773699, -73.980215], [40.777799, -73.980215], [40.773699, -73.984315], [40.781899, -73.980215],
    [40.777799, -73.984315], [40.777799, -73.988415], [40.777799, -73.992515], [40.781899, -73.984315],
    [40.781899, -73.988415], [40.785999, -73.984315], [40.785999, -73.980215], [40.790099, -73.984315],
    [40.790099, -73.980215], [40.794199, -73.980215], [40.798299, -73.980215], [40.794199, -73.976115],
    [40.790099, -73.976115], [40.794199, -73.972015], [40.790099, -73.972015], [40.785999, -73.976115],
    [40.790099, -73.967915], [40.790099, -73.963815], [40.785999, -73.972015], [40.785999, -73.967915],
    [40.781899, -73.967915], [40.781899, -73.972015], [40.777799, -73.972015], [40.781899, -73.976115],
    [40.777799, -73.976115], [40.773699, -73.976115]
];

// Group 3
var grp3Coords = [
    [40.765499, -73.992515], [40.765499, -73.996615], [40.765499, -74.000715], [40.769599, -74.000715],
    [40.769599, -73.996615], [40.769599, -73.992515], [40.773699, -73.996615], [40.773699, -73.992515],
    [40.773699, -73.988415], [40.769599, -73.988415], [40.769599, -73.984315], [40.769599, -73.980215],
    [40.769599, -73.976115], [40.765499, -73.980215], [40.765499, -73.984315], [40.761399, -73.984315],
    [40.765499, -73.988415], [40.761399, -73.988415]
];

// Group 4
var grp4Coords = [
    [40.753199, -73.972015], [40.757299, -73.972015], [40.757299, -73.976115], [40.757299, -73.980215],
    [40.761399, -73.980215], [40.761399, -73.976115], [40.761399, -73.972015], [40.765499, -73.976115],
    [40.765499, -73.972015], [40.765499, -73.967915], [40.761399, -73.967915], [40.761399, -73.963815],
    [40.761399, -73.959715], [40.757299, -73.959715], [40.757299, -73.963815], [40.753199, -73.963815],
    [40.757299, -73.967915], [40.753199, -73.967915],   
];

// Group 5
var grp5Coords = [
    [40.753199, -73.996615], [40.753199, -74.000715], [40.757299, -74.008915], [40.757299, -74.004815],
    [40.757299, -74.000715], [40.761399, -74.004815], [40.761399, -74.000715], [40.757299, -73.996615],
    [40.761399, -73.996615], [40.761399, -73.992515], [40.757299, -73.992515], [40.757299, -73.988415],
    [40.757299, -73.984315], [40.753199, -73.988415], [40.753199, -73.992515], [40.749099, -73.992515]
];

// Group 6
var grp6Coords = [
    [40.732699, -73.984315], [40.736799, -73.984315], [40.736799, -73.988415], [40.736799, -73.992515],
    [40.740899, -73.992515], [40.740899, -73.988415], [40.744999, -73.988415], [40.740899, -73.984315], 
    [40.740899, -73.980215], [40.740899, -73.976115], [40.736799, -73.976115], [40.736799, -73.980215], 
    [40.732699, -73.976115], [40.728599, -73.976115], [40.732699, -73.980215]
];

// Group 7
var grp7Coords = [
    [40.740899, -74.004815], [40.744999, -74.004815], [40.744999, -74.008915], [40.744999, -74.013015],
    [40.749099, -74.008915], [40.753199, -74.008915], [40.749099, -74.004815], [40.753199, -74.004815],
    [40.749099, -74.000715], [40.749099, -73.996615], [40.744999, -73.992515], [40.744999, -73.996615],
    [40.744999, -74.000715], [40.740899, -73.996615]
];

// Group 8
var grp8Coords = [
    [40.720399, -74.008915], [40.720399, -74.013015], [40.720399, -74.017115], [40.724499, -74.013015],
    [40.724499, -74.008915], [40.728599, -74.013015], [40.728599, -74.008915], [40.728599, -74.004815],
    [40.724499, -74.004815], [40.724499, -74.000715], [40.724499, -73.996615], [40.720399, -74.000715],
    [40.720399, -74.004815], [40.716299, -74.004815]
];

// Group 9
var grp9Coords = [
    [40.724499, -73.988415], [40.724499, -73.992515], [40.728599, -73.996615], [40.728599, -73.992515],
    [40.728599, -73.988415], [40.732699, -73.992515], [40.732699, -73.988415], [40.728599, -73.984315],
    [40.728599, -73.980215], [40.724499, -73.976115], [40.724499, -73.980215], [40.720399, -73.976115],
    [40.724499, -73.984315]
];

// Group 10
var grp10Coords = [
    [40.708099, -74.000715], [40.703999, -74.008915], [40.703999, -74.013015], [40.708099, -74.004815],
    [40.708099, -74.008915], [40.712199, -74.004815], [40.712199, -74.000715], [40.716299, -74.000715],
    [40.712199, -73.996615], [40.712199, -73.992515], [40.712199, -73.988415], [40.712199, -73.984315],
    [40.712199, -73.980215]
];

// Group 11
var grp11Coords = [
    [40.732699, -74.008915], [40.732699, -74.013015], [40.736799, -74.013015], [40.736799, -74.008915],
    [40.740899, -74.013015], [40.740899, -74.008915], [40.736799, -74.004815], [40.736799, -74.000715],
    [40.736799, -73.996615], [40.732699, -73.996615], [40.732699, -74.000715], [40.728599, -74.000715],
    [40.732699, -74.004815]
];

// Group 12
var grp12Coords = [
    [40.744999, -73.980215], [40.744999, -73.984315], [40.749099, -73.988415], [40.749099, -73.984315],
    [40.749099, -73.980215], [40.753199, -73.984315], [40.753199, -73.980215], [40.753199, -73.976115],
    [40.749099, -73.976115], [40.749099, -73.972015], [40.749099, -73.967915], [40.744999, -73.972015],
    [40.744999, -73.976115]
];

// Group 13
var grp13Coords = [
    [40.716299, -73.988415], [40.716299, -73.992515], [40.716299, -73.996615], [40.720399, -73.996615],
    [40.720399, -73.992515], [40.720399, -73.988415], [40.720399, -73.984315], [40.720399, -73.980215],
    [40.716299, -73.976115], [40.716299, -73.980215], [40.716299, -73.984315]
];

// Group 14
var grp14Coords = [
    [40.703999, -74.017115], [40.708099, -74.017115], [40.712199, -74.017115], [40.716299, -74.017115],
    [40.716299, -74.013015], [40.716299, -74.008915], [40.712199, -74.013015], [40.712199, -74.008915],
    [40.708099, -74.013015]
];

// Group -2
var grpNeg2Coords = [
    [40.806499, -73.951515], [40.810599, -73.951515], [40.814699, -73.951515], [40.818799, -73.951515],
    [40.802399, -73.955615], [40.806499, -73.955615], [40.794199, -73.959715], [40.798299, -73.959715],
    [40.810599, -73.955615], [40.802399, -73.959715], [40.822899, -73.951515], [40.794199, -73.963815],
    [40.814699, -73.955615], [40.806499, -73.959715], [40.798299, -73.963815], [40.794199, -73.967915],
    [40.802399, -73.963815], [40.703999, -74.021215], [40.810599, -73.959715], [40.708099, -74.021215],
    [40.798299, -73.967915], [40.712199, -74.021215], [40.716299, -74.021215], [40.818799, -73.955615],
    [40.806499, -73.963815], [40.728599, -74.017115], [40.802399, -73.967915], [40.798299, -73.972015],
    [40.814699, -73.959715], [40.810599, -73.963815], [40.806499, -73.967915], [40.802399, -73.972015],
    [40.765499, -74.004815], [40.798299, -73.976115], [40.781899, -73.992515], [40.802399, -73.976115],
    [40.806499, -73.972015], [40.810599, -73.967915], [40.814699, -73.963815], [40.818799, -73.959715],
    [40.822899, -73.955615], [40.814699, -73.967915], [40.826999, -73.951515], [40.818799, -73.963815],
    [40.822899, -73.959715], [40.822899, -73.963815], [40.826999, -73.955615], [40.826999, -73.959715],
    [40.831099, -73.955615], [40.831099, -73.951515], [40.835199, -73.951515], [40.839299, -73.951515],
    [40.851599, -73.947415], [40.847499, -73.947415], [40.843399, -73.947415], [40.839299, -73.947415],
    [40.855699, -73.943315], [40.851599, -73.943315], [40.835199, -73.947415], [40.847499, -73.943315],
    [40.859799, -73.939215], [40.872099, -73.935115], [40.867999, -73.935115], [40.855699, -73.939215],
    [40.876199, -73.931015], [40.843399, -73.943315], [40.863899, -73.935115], [40.872099, -73.931015],
    [40.851599, -73.939215], [40.859799, -73.935115], [40.867999, -73.931015], [40.876199, -73.926915],
    [40.872099, -73.926915], [40.863899, -73.931015], [40.855699, -73.935115], [40.847499, -73.939215],
    [40.839299, -73.943315], [40.876199, -73.922815], [40.867999, -73.926915], [40.859799, -73.931015],
    [40.872099, -73.922815], [40.851599, -73.935115], [40.863899, -73.926915], [40.867999, -73.922815],
    [40.855699, -73.931015], [40.843399, -73.939215], [40.872099, -73.918715], [40.831099, -73.947415],
    [40.859799, -73.926915], [40.847499, -73.935115], [40.863899, -73.922815], [40.867999, -73.918715],
    [40.851599, -73.931015], [40.872099, -73.914615], [40.855699, -73.926915], [40.859799, -73.922815],
    [40.863899, -73.918715], [40.867999, -73.914615], [40.835199, -73.943315], [40.839299, -73.939215],
    [40.843399, -73.935115], [40.847499, -73.931015], [40.851599, -73.926915], [40.855699, -73.922815],
    [40.843399, -73.931015], [40.839299, -73.935115], [40.835199, -73.939215], [40.835199, -73.935115],
    [40.831099, -73.943315], [40.831099, -73.939215], [40.831099, -73.935115], [40.826999, -73.935115],
    [40.826999, -73.939215], [40.826999, -73.943315], [40.822899, -73.939215], [40.822899, -73.943315],
    [40.826999, -73.947415], [40.818799, -73.943315], [40.822899, -73.947415], [40.818799, -73.947415],
    [40.814699, -73.947415], [40.810599, -73.947415]
];

// Insert data into the 'newyorkcity' collection.
newyorkcity = new NYCModel({gid: "0" , coords: grp0Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "1" , coords: grp1Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "2" , coords: grp2Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "3" , coords: grp3Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "4" , coords: grp4Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "5" , coords: grp5Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "6" , coords: grp6Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "7", coords: grp7Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "8" , coords: grp8Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "9" , coords: grp9Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "10", coords: grp10Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "11", coords: grp11Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "12", coords: grp12Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "13", coords: grp13Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "14", coords: grp14Coords});
newyorkcity.save();
newyorkcity = new NYCModel({gid: "-2", coords: grpNeg2Coords});
newyorkcity.save();
*/

/* ========== */
/* DATA : END */
/* ========== */

/* ===================== */
/* GET LISTENERS : BEGIN */
/* ===================== */

/* Easter egg */
app.get("/asciimo", function(req, res)
{
    var link = "http://i.imgur.com/kmbjB.png";
    res.send("<html><body><img src='" + link + "'></body></html>");
});

/* API summary */
app.get("/api", function(req, res)
{
    res.send(
        "<body style='font-family: Arial;'>" + 
            "<h1>Farpoint</h1>" +
            "<p style='font-size: 18px;'>Uber Surge Pricing Application (SPA) API</p>" +
        "</body>");
});

/* Author information */
app.get("/api/author", function(req, res)
{
    res.json(author);
});

/* Groups numbers */
app.get("/api/nyc/groups", function(req, res)
{
    NYCModel.find({}, {gid: 1}, function(err, data)
    {
        res.json(data);
    });
});

/* The set of co-ordinate pairs for the group. */
app.get("/api/nyc/group/:gid/coords", function(req, res)
{
    NYCModel.find({gid: req.params.gid}, function(err, doc)
    {
        res.json(doc);
    });
});

/* =================== */
/* GET LISTENERS : END */
/* =================== */

/* Main */
app.listen(port, ip);

/* End of server.js */